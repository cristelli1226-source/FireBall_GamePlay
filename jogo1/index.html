<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üî• Reflex Trainer CS Edition - √âPICO! üí£</title>
<style>
  * {
    box-sizing: border-box;
    touch-action: manipulation;
  }
  body {
    background: #111;
    color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    margin: 0;
    padding: 10px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    text-align: center;
  }
  #menu-screen { background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%); }
  #game-screen { display: none; }
  #shop-screen { display: none; background: linear-gradient(135deg, #2a1a2a 0%, #1a2a2a 100%); }

  h1 {
    margin-bottom: 20px;
    font-size: clamp(1.8rem, 6vw, 3rem);
    text-shadow: 0 0 15px #ff3b3b;
    background: linear-gradient(45deg, #ff3b3b, #ff7b7b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  h2 {
    margin-bottom: 15px;
    color: #ff7b7b;
  }

  .time-options, .difficulty-options, .game-mode-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 90%;
    max-width: 300px;
    margin-bottom: 20px;
  }

  .time-btn, .diff-btn, .mode-btn, .shop-btn {
    background: linear-gradient(45deg, #333, #444);
    color: #fff;
    border: none;
    padding: 15px 25px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .time-btn:hover, .time-btn.selected,
  .diff-btn:hover, .diff-btn.selected,
  .mode-btn:hover, .mode-btn.selected,
  .shop-btn:hover:not(:disabled) {
    background: linear-gradient(45deg, #ff3b3b, #ff5b5b);
    box-shadow: 0 0 20px rgba(255, 59, 59, 0.6);
  }

  .shop-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  #game-area {
    position: relative;
    width: 95vw;
    height: 65vh;
    max-width: 600px;
    border: 3px solid #444;
    background-color: #000;
    border-radius: 15px;
    overflow: hidden;
    cursor: crosshair;
    box-shadow: 0 0 20px rgba(255, 59, 59, 0.3);
  }

  .circle {
    position: absolute;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.15s ease;
  }
  .circle:hover { transform: scale(1.1); }
  .circle:active { transform: scale(0.95); }

  /* C4 - Formato retangular com design realista e texto PRETO */
  .c4-bomb {
    position: absolute;
    width: 70px;
    height: 40px;
    background: linear-gradient(45deg, #8B4513, #A0522D);
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 0 25px #ff4444;
    border: 2px solid #ff4444;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #000000;
    font-size: 16px;
    text-shadow: 0 0 2px #ffffff;
    animation: c4Danger 0.2s infinite alternate;
  }
  @keyframes c4Danger {
    from { box-shadow: 0 0 20px #ff0000; transform: scale(1); }
    to { box-shadow: 0 0 40px #ff6666; transform: scale(1.05); }
  }

  /* GRANADA - Formato de granada pingando */
  .grenade {
    position: absolute;
    width: 45px;
    height: 65px;
    background: linear-gradient(45deg, #0044ff, #0088ff);
    border-radius: 8px 8px 20px 20px;
    cursor: pointer;
    box-shadow: 0 0 20px #00aaff;
    animation: bounceGrenade 0.6s infinite alternate;
  }
  @keyframes bounceGrenade {
    from { transform: translateY(0px); box-shadow: 0 0 15px #00aaff; }
    to { transform: translateY(-8px); box-shadow: 0 0 30px #66ccff; }
  }

  /* FLASHBANG - Formato fino e alongado */
  .flashbang {
    position: absolute;
    width: 35px;
    height: 80px;
    background: linear-gradient(45deg, #ffffff, #cccccc);
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 0 25px #ffffff;
    animation: rotateFlashbang 3s infinite linear;
  }
  @keyframes rotateFlashbang {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* MOLOTOV - Formato de garrafa */
  .molotov {
    position: absolute;
    width: 30px;
    height: 50px;
    background: linear-gradient(45deg, #ff4400, #ff8800);
    border-radius: 5px 5px 15px 15px;
    cursor: pointer;
    box-shadow: 0 0 20px #ff4400;
    animation: molotovFlicker 0.3s infinite alternate;
  }
  .molotov::before {
    content: "";
    position: absolute;
    top: -10px;
    left: 5px;
    width: 20px;
    height: 15px;
    background: #ff4400;
    border-radius: 10px 10px 0 0;
    box-shadow: 0 0 15px #ff4400;
  }
  @keyframes molotovFlicker {
    from { box-shadow: 0 0 15px #ff4400; }
    to { box-shadow: 0 0 25px #ff8800; }
  }

  /* NOVOS ELEMENTOS √âPICOS */
  
  /* üîÆ Orbe do Tempo */
  .time-orb {
    position: absolute;
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, #aa00ff, #6600cc);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 30px #aa00ff;
    animation: orbPulse 2s infinite alternate;
  }
  @keyframes orbPulse {
    from { transform: scale(1); box-shadow: 0 0 20px #aa00ff; }
    to { transform: scale(1.2); box-shadow: 0 0 40px #cc66ff; }
  }

  /* üíé Cristal Multiplicador */
  .crystal {
    position: absolute;
    width: 50px;
    height: 50px;
    background: conic-gradient(#00ff88, #00ccff, #ff00cc, #00ff88);
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 0 25px #00ff88;
    animation: crystalRotate 3s infinite linear;
    transform-style: preserve-3d;
  }
  @keyframes crystalRotate {
    from { transform: rotate(0deg) rotateX(20deg); }
    to { transform: rotate(360deg) rotateX(20deg); }
  }

  /* üå™Ô∏è Vortex Negro */
  .vortex {
    position: absolute;
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, #000000, #330066);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 40px #6600cc;
    animation: vortexSpin 4s infinite linear;
  }
  @keyframes vortexSpin {
    from { transform: rotate(0deg) scale(1); }
    to { transform: rotate(360deg) scale(1.1); }
  }

  /* üé≠ M√≠mico (Inimigo) */
  .mimic {
    position: absolute;
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, #ff3b3b, #aa0000);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 20px #ff3b3b;
    animation: mimicBlink 1s infinite alternate;
  }
  .mimic::before, .mimic::after {
    content: "‚óè";
    position: absolute;
    top: 15px;
    font-size: 12px;
    color: #000;
  }
  .mimic::before { left: 15px; }
  .mimic::after { right: 15px; }
  @keyframes mimicBlink {
    from { opacity: 1; }
    to { opacity: 0.7; }
  }

  /* üëæ Mega C4 (Boss) */
  .mega-c4 {
    position: absolute;
    width: 120px;
    height: 70px;
    background: linear-gradient(45deg, #8B4513, #A0522D);
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 40px #ff0000;
    border: 3px solid #ff0000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #000;
    font-size: 20px;
    text-shadow: 0 0 3px #fff;
    animation: megaC4Pulse 0.5s infinite alternate;
  }
  @keyframes megaC4Pulse {
    from { transform: scale(1); box-shadow: 0 0 30px #ff0000; }
    to { transform: scale(1.1); box-shadow: 0 0 50px #ff6666; }
  }

  /* Efeitos visuais */
  .flash-effect {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 170, 255, 0.5);
    animation: flash 0.3s ease-out;
    pointer-events: none;
    z-index: 999;
  }
  @keyframes flash {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  .white-flash {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.9);
    animation: whiteFlash 0.5s ease-out;
    pointer-events: none;
    z-index: 999;
  }
  @keyframes whiteFlash {
    0% { opacity: 1; }
    70% { opacity: 0.8; }
    100% { opacity: 0; }
  }

  .freeze-effect {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(100, 200, 255, 0.2);
    pointer-events: none;
    z-index: 998;
  }

  .fire-effect {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(45deg, rgba(255,0,0,0.3), rgba(255,100,0,0.4));
    pointer-events: none;
    z-index: 997;
    animation: fireAnimation 0.5s infinite alternate;
  }
  @keyframes fireAnimation {
    from { opacity: 0.6; }
    to { opacity: 0.9; }
  }

  .rainbow-effect {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(45deg, 
      rgba(255,0,0,0.2), 
      rgba(255,165,0,0.2), 
      rgba(255,255,0,0.2), 
      rgba(0,255,0,0.2), 
      rgba(0,0,255,0.2), 
      rgba(75,0,130,0.2), 
      rgba(238,130,238,0.2));
    pointer-events: none;
    z-index: 996;
    animation: rainbowShift 2s infinite alternate;
  }
  @keyframes rainbowShift {
    from { filter: hue-rotate(0deg); }
    to { filter: hue-rotate(360deg); }
  }

  .slowmo-effect {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 255, 255, 0.1);
    pointer-events: none;
    z-index: 995;
  }

  .explosion-effect {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255, 0, 0, 0.6);
    animation: explosionFlash 0.5s ease-out;
    pointer-events: none;
    z-index: 999;
  }
  @keyframes explosionFlash {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.1); }
    100% { opacity: 0; transform: scale(1.2); }
  }

  .warning-message {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 123, 0, 0.9);
    color: white;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: 1.2rem;
    font-weight: bold;
    text-align: center;
    animation: warningFlash 2s ease-in-out;
    z-index: 100;
  }

  .bonus-message {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 255, 0, 0.9);
    color: black;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: 1.4rem;
    font-weight: bold;
    text-align: center;
    animation: bonusFlash 1.5s ease-in-out;
    z-index: 100;
  }

  .penalty-message {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 0, 0, 0.9);
    color: white;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: 1.4rem;
    font-weight: bold;
    text-align: center;
    animation: penaltyFlash 1.5s ease-in-out;
    z-index: 100;
  }

  .epic-message {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(45deg, #ff00ff, #00ffff);
    color: black;
    padding: 20px 30px;
    border-radius: 15px;
    font-size: 1.6rem;
    font-weight: bold;
    text-align: center;
    animation: epicFlash 2s ease-in-out;
    z-index: 100;
  }
  @keyframes epicFlash {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
  }

  @keyframes warningFlash {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
  }

  @keyframes bonusFlash {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
  }

  @keyframes penaltyFlash {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
  }

  .level-indicator {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(255, 59, 59, 0.2);
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 0.9rem;
    border: 1px solid #ff3b3b;
  }

  .time-indicator {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0, 170, 255, 0.2);
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 0.9rem;
    border: 1px solid #00aaff;
  }

  .multiplier-indicator {
    position: absolute;
    top: 40px;
    right: 10px;
    background: rgba(0, 255, 0, 0.2);
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 0.9rem;
    border: 1px solid #00ff00;
  }

  .coins-indicator {
    position: absolute;
    top: 40px;
    left: 10px;
    background: rgba(255, 215, 0, 0.2);
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 0.9rem;
    border: 1px solid #ffd700;
  }

  .freeze-timer {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    color: #00aaff;
    text-shadow: 0 0 10px #00aaff;
    font-weight: bold;
    z-index: 1000;
  }

  .fire-warning {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    color: #ff4400;
    text-shadow: 0 0 10px #ff4400;
    font-weight: bold;
    z-index: 1000;
    text-align: center;
  }

  .shop-section {
    margin: 20px 0;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
  }

  .stats-section {
    margin: 15px 0;
    padding: 10px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
  }

  .achievement-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(45deg, #ffd700, #ffed4e);
    color: #000;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 30px #ffd700;
    z-index: 10000;
    text-align: center;
    animation: achievementPop 3s ease-in-out;
  }
  @keyframes achievementPop {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
  }

</style>
</head>
<body>

<div id="menu-screen" class="screen">
  <h1>üî• Reflex Trainer CS Edition - √âPICO! üí£</h1>
  
  <h2>Selecione o Tempo</h2>
  <div class="time-options">
    <button class="time-btn" data-time="30">‚è±Ô∏è 30 Segundos</button>
    <button class="time-btn" data-time="60">‚è±Ô∏è 1 Minuto</button>
    <button class="time-btn" data-time="0">üé™ Sobreviv√™ncia</button>
  </div>

  <h2>Escolha a Dificuldade</h2>
  <div class="difficulty-options">
    <button class="diff-btn" data-diff="easy">üü¢ F√°cil</button>
    <button class="diff-btn" data-diff="medium">üü° M√©dio</button>
    <button class="diff-btn" data-diff="hard">üî¥ Dif√≠cil</button>
  </div>

  <h2>Modo de Jogo</h2>
  <div class="game-mode-options">
    <button class="mode-btn" data-mode="classic">üéØ Cl√°ssico</button>
    <button class="mode-btn" data-mode="precision">üéØ Precis√£o</button>
    <button class="mode-btn" data-mode="bomberman">üí£ Bomberman</button>
  </div>

  <div class="stats-section">
    <div>ü™ô Moedas: <span id="total-coins">0</span></div>
    <div>üèÜ Recorde: <span id="high-score">0</span></div>
    <div>üéÆ Conquistas: <span id="achievements-count">0</span>/12</div>
  </div>

  <div style="display: flex; gap: 10px; margin-top: 20px;">
    <button id="start-game-btn" style="display:none;">üéÆ Iniciar Jogo</button>
    <button id="shop-btn">üõí Loja</button>
  </div>
</div>

<div id="shop-screen" class="screen">
  <h1>üõí Loja de Power-ups</h1>
  
  <div class="shop-section">
    <h3>‚ö° Power-ups Ativos</h3>
    <div>‚è±Ô∏è +5s Iniciais: <span id="time-plus-level">0</span>/3</div>
    <div>üê¢ In√≠cio Lento: <span id="slow-start-level">0</span>/2</div>
    <div>üß≤ Aura Magn√©tica: <span id="magnet-level">0</span>/1</div>
  </div>

  <div class="shop-section">
    <h3>üõí Comprar Melhorias</h3>
    <button class="shop-btn" data-powerup="time_plus" data-cost="50">
      ‚è±Ô∏è +5s Iniciais (50 moedas)
    </button>
    <button class="shop-btn" data-powerup="slow_start" data-cost="75">
      üê¢ In√≠cio Lento (75 moedas)
    </button>
    <button class="shop-btn" data-powerup="magnet" data-cost="100">
      üß≤ Aura Magn√©tica (100 moedas)
    </button>
  </div>

  <div style="margin: 20px 0; font-size: 1.2rem;">
    ü™ô Suas Moedas: <span id="shop-coins">0</span>
  </div>

  <button id="back-to-menu-btn">üè† Voltar ao Menu</button>
</div>

<div id="game-screen" class="screen">
  <h1>üî• Reflex Trainer CS Edition - √âPICO! üí£</h1>
  <div id="game-area">
    <div class="level-indicator">Pontos: 0</div>
    <div class="time-indicator">C4: +0s</div>
    <div class="multiplier-indicator">Multiplicador: 1x</div>
    <div class="coins-indicator">ü™ô: 0</div>
  </div>
  <div id="scoreboard">Pontos: 0 | Tempo: 30s | Modo: Cl√°ssico</div>
  <div>
    <button id="pause-btn">‚è∏Ô∏è Pausar</button>
    <button id="menu-btn">üè† Menu</button>
  </div>
</div>

<script>
// ===== VARI√ÅVEIS GLOBAIS =====
const menuScreen = document.getElementById('menu-screen');
const gameScreen = document.getElementById('game-screen');
const shopScreen = document.getElementById('shop-screen');
const gameArea = document.getElementById('game-area');
const scoreboard = document.getElementById('scoreboard');
const timeButtons = document.querySelectorAll('.time-btn');
const diffButtons = document.querySelectorAll('.diff-btn');
const modeButtons = document.querySelectorAll('.mode-btn');
const shopButtons = document.querySelectorAll('.shop-btn');
const startGameBtn = document.getElementById('start-game-btn');
const shopBtn = document.getElementById('shop-btn');
const backToMenuBtn = document.getElementById('back-to-menu-btn');
const pauseBtn = document.getElementById('pause-btn');
const menuBtn = document.getElementById('menu-btn');

// Estado do jogo
let score = 0, timeLeft = 30, selectedTime = 30, difficulty = "medium", gameMode = "classic";
let gameActive = false, gamePaused = false, movementEnabled = false, frenzyMode = false;
let circles = [], gameInterval, timerInterval, movementInterval;
let grenadeInterval, c4Interval, flashbangInterval, molotovInterval;
let timeOrbInterval, crystalInterval, vortexInterval, mimicInterval, bossInterval;
let circleSize = 60, speedMultiplier = 1;
let totalBonusTime = 0;
let freezeActive = false, fireActive = false, slowmoActive = false, rainbowActive = false;
let pointMultiplier = 1, coins = 0, totalCoins = 0, highScore = 0;
let achievements = new Set();
let originalCircleClickHandlers = new Map();

// Estat√≠sticas
let gamesPlayed = 0, totalPoints = 0, c4Disarmed = 0, grenadesUsed = 0;
let timeOrbsUsed = 0, crystalsUsed = 0, mimicsKilled = 0;

// Power-ups da loja
let shopItems = {
  time_plus: { level: 0, maxLevel: 3 },
  slow_start: { level: 0, maxLevel: 2 },
  magnet: { level: 0, maxLevel: 1 }
};

// Conquistas
const achievementList = {
  first_blood: { name: "ü©∏ Primeiro Sangue", desc: "Fa√ßa seu primeiro ponto" },
  speed_demon: { name: "‚ö° Dem√¥nio da Velocidade", desc: "50 pontos em 30 segundos" },
  bomb_squad: { name: "üí£ Esquadr√£o Anti-Bombas", desc: "Desative 5 C4s" },
  fire_proof: { name: "üî• √Ä Prova de Fogo", desc: "Sobreviva a 3 Molotovs" },
  reflex_master: { name: "üéØ Mestre dos Reflexos", desc: "200 pontos" },
  rich: { name: "üí∞ Rico", desc: "Ganhe 100 moedas" },
  collector: { name: "üîÑ Colecionador", desc: "Use todos os power-ups" },
  survivor: { name: "üèÜ Sobrevivente", desc: "Complete modo sobreviv√™ncia" },
  precise: { name: "üéØ Preciso", desc: "Modo precis√£o sem erros" },
  bomber: { name: "üí£ Bomberman", desc: "Modo bomberman perfeito" },
  orb_master: { name: "üîÆ Mestre do Tempo", desc: "Use 10 orbes do tempo" },
  crystal_king: { name: "üíé Rei dos Cristais", desc: "Use 5 cristais multiplicadores" }
};

// ===== INICIALIZA√á√ÉO =====
loadGameData();

timeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    timeButtons.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedTime = parseInt(btn.dataset.time);
    checkReady();
  });
});

diffButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    diffButtons.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    difficulty = btn.dataset.diff;
    checkReady();
  });
});

modeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    modeButtons.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    gameMode = btn.dataset.mode;
    checkReady();
  });
});

shopButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const powerup = btn.dataset.powerup;
    const cost = parseInt(btn.dataset.cost);
    buyPowerUp(powerup, cost, btn);
  });
});

startGameBtn.addEventListener('click', startGame);
shopBtn.addEventListener('click', () => { 
  menuScreen.style.display = 'none'; 
  shopScreen.style.display = 'flex'; 
  updateShopDisplay(); 
});
backToMenuBtn.addEventListener('click', () => { 
  shopScreen.style.display = 'none'; 
  menuScreen.style.display = 'flex'; 
});
menuBtn.addEventListener('click', () => { resetGame(); menuScreen.style.display = 'flex'; gameScreen.style.display = 'none'; });
pauseBtn.addEventListener('click', togglePause);

function checkReady() {
  if (document.querySelector('.time-btn.selected') && 
      document.querySelector('.diff-btn.selected') && 
      document.querySelector('.mode-btn.selected')) {
    startGameBtn.style.display = 'block';
  }
}

// ===== SISTEMA DE ARMAZENAMENTO =====
function saveGameData() {
  const gameData = {
    totalCoins,
    highScore,
    achievements: Array.from(achievements),
    shopItems,
    gamesPlayed,
    totalPoints,
    c4Disarmed,
    grenadesUsed,
    timeOrbsUsed,
    crystalsUsed,
    mimicsKilled
  };
  localStorage.setItem('reflexTrainerData', JSON.stringify(gameData));
  updateMenuStats();
}

function loadGameData() {
  const saved = localStorage.getItem('reflexTrainerData');
  if (saved) {
    const gameData = JSON.parse(saved);
    totalCoins = gameData.totalCoins || 0;
    highScore = gameData.highScore || 0;
    achievements = new Set(gameData.achievements || []);
    shopItems = gameData.shopItems || {
      time_plus: { level: 0, maxLevel: 3 },
      slow_start: { level: 0, maxLevel: 2 },
      magnet: { level: 0, maxLevel: 1 }
    };
    gamesPlayed = gameData.gamesPlayed || 0;
    totalPoints = gameData.totalPoints || 0;
    c4Disarmed = gameData.c4Disarmed || 0;
    grenadesUsed = gameData.grenadesUsed || 0;
    timeOrbsUsed = gameData.timeOrbsUsed || 0;
    crystalsUsed = gameData.crystalsUsed || 0;
    mimicsKilled = gameData.mimicsKilled || 0;
  }
  updateMenuStats();
}

function updateMenuStats() {
  document.getElementById('total-coins').textContent = totalCoins;
  document.getElementById('high-score').textContent = highScore;
  document.getElementById('achievements-count').textContent = achievements.size;
}

// ===== SISTEMA DE LOJA =====
function buyPowerUp(powerup, cost, button) {
  if (totalCoins >= cost && shopItems[powerup].level < shopItems[powerup].maxLevel) {
    totalCoins -= cost;
    shopItems[powerup].level++;
    updateShopDisplay();
    saveGameData();
    showBonusMessage(`‚úÖ ${powerup.replace('_', ' ').toUpperCase()} comprado!`);
  }
}

function updateShopDisplay() {
  document.getElementById('shop-coins').textContent = totalCoins;
  document.getElementById('time-plus-level').textContent = shopItems.time_plus.level;
  document.getElementById('slow-start-level').textContent = shopItems.slow_start.level;
  document.getElementById('magnet-level').textContent = shopItems.magnet.level;
  
  shopButtons.forEach(btn => {
    const powerup = btn.dataset.powerup;
    const cost = parseInt(btn.dataset.cost);
    if (shopItems[powerup].level >= shopItems[powerup].maxLevel) {
      btn.textContent = `‚úÖ ${btn.textContent.split('(')[0].trim()} (MAX)`;
      btn.disabled = true;
    } else if (totalCoins < cost) {
      btn.disabled = true;
    } else {
      btn.disabled = false;
    }
  });
}

// ===== SISTEMA DE CONQUISTAS =====
function unlockAchievement(id) {
  if (!achievements.has(id) && achievementList[id]) {
    achievements.add(id);
    showAchievementPopup(achievementList[id]);
    coins += 25; // Recompensa em moedas
    totalCoins += 25;
    saveGameData();
  }
}

function showAchievementPopup(achievement) {
  const popup = document.createElement('div');
  popup.className = 'achievement-popup';
  popup.innerHTML = `
    <div style="font-size: 2rem; margin-bottom: 10px;">üèÜ</div>
    <div style="font-weight: bold; font-size: 1.2rem;">${achievement.name}</div>
    <div style="font-size: 0.9rem;">${achievement.desc}</div>
    <div style="margin-top: 10px; font-size: 0.8rem;">+25 ü™ô</div>
  `;
  document.body.appendChild(popup);
  
  setTimeout(() => {
    popup.remove();
  }, 3000);
}

// ===== CONFIGURA√á√ÉO DO JOGO =====
function setDifficultyParams() {
  switch(difficulty) {
    case "easy": 
      circleSize = 80; 
      speedMultiplier = 1; 
      break;
    case "medium": 
      circleSize = 60; 
      speedMultiplier = 1.3; 
      break;
    case "hard": 
      circleSize = 40; 
      speedMultiplier = 1.6; 
      break;
  }

  // Ajustes para modo de jogo
  if (gameMode === "precision") {
    circleSize = Math.max(30, circleSize - 20);
    speedMultiplier *= 0.8;
  } else if (gameMode === "bomberman") {
    circleSize = 70;
    speedMultiplier *= 0.6;
  }
}

// ===== FUN√á√ÉO PRINCIPAL DO JOGO =====
function startGame() {
  gamesPlayed++;
  setDifficultyParams();
  timeLeft = selectedTime + (shopItems.time_plus.level * 5);
  score = 0; totalBonusTime = 0; coins = 0; pointMultiplier = 1;
  menuScreen.style.display = 'none';
  gameScreen.style.display = 'flex';
  gameActive = true; gamePaused = false; 
  movementEnabled = false; frenzyMode = false; 
  freezeActive = false; fireActive = false; 
  slowmoActive = false; rainbowActive = false;
  
  updateScore(); updateLevelIndicator(); updateTimeIndicator(); updateMultiplierIndicator(); updateCoinsIndicator();
  
  if (gameMode !== "bomberman") {
    spawnCircle();
  }

  // Timer principal
  timerInterval = setInterval(() => { 
    if (!gameActive || gamePaused || freezeActive) return; 
    timeLeft--; 
    updateScore(); 
    if (timeLeft <= 0 && selectedTime > 0) endGame(); 
  }, 1000);
  
  // Spawn de elementos baseado no modo
  if (gameMode === "classic" || gameMode === "survival") {
    gameInterval = setInterval(() => { 
      if (!gameActive || gamePaused || freezeActive) return; 
      const maxCircles = gameMode === 'precision' ? 2 : 3;
      if (document.querySelectorAll('.circle').length < maxCircles) spawnCircle(); 
    }, gameMode === 'precision' ? 1200 : 800);
    
    grenadeInterval = setInterval(() => { spawnGrenade(); }, randomRange(12000, 18000));
    flashbangInterval = setInterval(() => { spawnFlashbang(); }, randomRange(10000, 15000));
    molotovInterval = setInterval(() => { spawnMolotov(); }, randomRange(8000, 12000));
    timeOrbInterval = setInterval(() => { spawnTimeOrb(); }, randomRange(15000, 25000));
    crystalInterval = setInterval(() => { spawnCrystal(); }, randomRange(20000, 30000));
    vortexInterval = setInterval(() => { spawnVortex(); }, randomRange(25000, 35000));
    mimicInterval = setInterval(() => { spawnMimic(); }, randomRange(10000, 20000));
  } else if (gameMode === "bomberman") {
    // Modo Bomberman - mais C4s e granadas
    c4Interval = setInterval(() => { spawnC4(); }, randomRange(3000, 6000));
    grenadeInterval = setInterval(() => { spawnGrenade(); }, randomRange(5000, 8000));
  }
  
  // C4 em todos os modos (mais frequente no bomberman)
  if (gameMode !== "bomberman") {
    c4Interval = setInterval(() => { spawnC4(); }, randomRange(15000, 20000));
  }
  
  // Movimento das bolinhas
  movementInterval = setInterval(() => { 
    if (!gameActive || gamePaused || freezeActive) return; 
    moveCircles(); 
  }, slowmoActive ? 200 : 100);
  
  // Boss ocasional
  bossInterval = setInterval(() => { 
    if (Math.random() < 0.3) spawnMegaC4(); 
  }, 30000);
  
  // Aplicar power-ups
  applyPowerUps();

  // Conquista Primeiro Sangue
  if (!achievements.has('first_blood')) {
    unlockAchievement('first_blood');
  }
}

function applyPowerUps() {
  if (shopItems.slow_start.level > 0) {
    movementEnabled = false;
    setTimeout(() => {
      if (gameActive) enableMovement();
    }, 10000 / shopItems.slow_start.level);
  }
  
  if (shopItems.magnet.level > 0) {
    gameArea.addEventListener('mousemove', handleMagnetAura);
    gameArea.addEventListener('touchmove', handleMagnetAura);
  }
}

function handleMagnetAura(e) {
  if (!gameActive || !shopItems.magnet.level) return;
  
  const rect = gameArea.getBoundingClientRect();
  const x = (e.clientX || e.touches[0].clientX) - rect.left;
  const y = (e.clientY || e.touches[0].clientY) - rect.top;
  
  document.querySelectorAll('.circle').forEach(circle => {
    const circleX = parseFloat(circle.style.left) + circleSize/2;
    const circleY = parseFloat(circle.style.top) + circleSize/2;
    const distance = Math.sqrt((x - circleX)**2 + (y - circleY)**2);
    
    if (distance < 150) {
      const angle = Math.atan2(y - circleY, x - circleX);
      const force = (150 - distance) / 50;
      circle.style.left = `${parseFloat(circle.style.left) + Math.cos(angle) * force}px`;
      circle.style.top = `${parseFloat(circle.style.top) + Math.sin(angle) * force}px`;
    }
  });
}

// ===== ELEMENTOS DO JOGO =====

// Bolinhas b√°sicas
function spawnCircle() {
  const circle = document.createElement('div');
  circle.classList.add('circle');
  circle.style.width = circle.style.height = circleSize + 'px';
  circle.style.background = 'radial-gradient(circle, #ff3b3b, #aa0000)';
  circle.style.boxShadow = '0 0 20px #ff3b3b';
  
  const maxX = gameArea.clientWidth - circleSize, maxY = gameArea.clientHeight - circleSize;
  let x = Math.random() * maxX, y = Math.random() * maxY;
  circle.style.left = `${x}px`; 
  circle.style.top = `${y}px`;
  
  if (movementEnabled) {
    circle.vx = (Math.random() - 0.5) * 4 * speedMultiplier;
    circle.vy = (Math.random() - 0.5) * 4 * speedMultiplier;
  }

  const clickHandler = (e) => {
    if (!gameActive || gamePaused) return;
    
    // Penalidade da Molotov
    if (fireActive) {
      timeLeft = Math.max(1, timeLeft - 5);
      showPenaltyMessage("üî• -5 SEGUNDOS!");
      updateScore();
    }
    
    // Pontua√ß√£o com multiplicador
    const pointsEarned = 1 * pointMultiplier;
    score += pointsEarned;
    coins += pointsEarned;
    totalPoints += pointsEarned;
    
    // Conquistas de pontua√ß√£o
    if (score >= 50 && timeLeft >= 20) unlockAchievement('speed_demon');
    if (score >= 200) unlockAchievement('reflex_master');
    if (coins >= 100) unlockAchievement('rich');
    
    // Progress√£o de dificuldade
    if (score === 20) enableMovement();
    if (score === 40) increaseSpeed();
    if (score === 60) activateFrenzy();
    
    circle.remove(); 
    circles.splice(circles.indexOf(circle), 1);
    
    if (gameMode !== "bomberman") {
      spawnCircle(); 
    }
    
    updateScore(); 
    updateLevelIndicator();
    updateCoinsIndicator();
  };

  circle.addEventListener('click', clickHandler);
  originalCircleClickHandlers.set(circle, clickHandler);
  
  gameArea.appendChild(circle); 
  circles.push(circle);
}

// üîÆ Orbe do Tempo
function spawnTimeOrb() {
  if (document.querySelector('.time-orb') || freezeActive) return;
  
  const orb = document.createElement('div');
  orb.classList.add('time-orb');
  
  const maxX = gameArea.clientWidth - 60, maxY = gameArea.clientHeight - 60;
  orb.style.left = `${Math.random() * maxX}px`;
  orb.style.top = `${Math.random() * maxY}px`;
  
  orb.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    activateTimeOrb();
    orb.remove();
    timeOrbsUsed++;
    if (timeOrbsUsed >= 10) unlockAchievement('orb_master');
  });
  
  gameArea.appendChild(orb);
  
  setTimeout(() => {
    if (orb.parentNode) orb.remove();
  }, 5000);
}

function activateTimeOrb() {
  freezeActive = true;
  const originalSpeeds = new Map();
  
  // Congela todos os elementos m√≥veis
  document.querySelectorAll('.circle, .c4-bomb, .mimic, .mega-c4').forEach(el => {
    if (el.vx !== undefined) {
      originalSpeeds.set(el, { vx: el.vx, vy: el.vy });
      el.vx = 0;
      el.vy = 0;
    }
  });
  
  const freezeEffect = document.createElement('div');
  freezeEffect.classList.add('freeze-effect');
  gameArea.appendChild(freezeEffect);
  
  let freezeTime = 3;
  const freezeTimer = document.createElement('div');
  freezeTimer.classList.add('freeze-timer');
  freezeTimer.textContent = `‚è∞ ${freezeTime}`;
  gameArea.appendChild(freezeTimer);
  
  const freezeCountdown = setInterval(() => {
    freezeTime--;
    freezeTimer.textContent = `‚è∞ ${freezeTime}`;
    
    if (freezeTime <= 0) {
      clearInterval(freezeCountdown);
      freezeActive = false;
      
      // Restaura velocidades
      originalSpeeds.forEach((speed, el) => {
        el.vx = speed.vx;
        el.vy = speed.vy;
      });
      
      freezeEffect.remove();
      freezeTimer.remove();
      showBonusMessage("‚è∞ TEMPO VOLTOU!");
    }
  }, 1000);
}

// üíé Cristal Multiplicador
function spawnCrystal() {
  if (document.querySelector('.crystal') || pointMultiplier > 1) return;
  
  const crystal = document.createElement('div');
  crystal.classList.add('crystal');
  
  const maxX = gameArea.clientWidth - 50, maxY = gameArea.clientHeight - 50;
  crystal.style.left = `${Math.random() * maxX}px`;
  crystal.style.top = `${Math.random() * maxY}px`;
  
  crystal.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    activateCrystal();
    crystal.remove();
    crystalsUsed++;
    if (crystalsUsed >= 5) unlockAchievement('crystal_king');
  });
  
  gameArea.appendChild(crystal);
  
  setTimeout(() => {
    if (crystal.parentNode) crystal.remove();
  }, 4000);
}

function activateCrystal() {
  pointMultiplier = 2;
  updateMultiplierIndicator();
  
  const rainbow = document.createElement('div');
  rainbow.classList.add('rainbow-effect');
  gameArea.appendChild(rainbow);
  
  showEpicMessage("üíé MULTIPLICADOR 2x ATIVADO!");
  
  setTimeout(() => {
    pointMultiplier = 1;
    updateMultiplierIndicator();
    rainbow.remove();
    showBonusMessage("üíé Multiplicador acabou!");
  }, 5000);
}

// üå™Ô∏è Vortex Negro
function spawnVortex() {
  if (document.querySelector('.vortex')) return;
  
  const vortex = document.createElement('div');
  vortex.classList.add('vortex');
  
  const maxX = gameArea.clientWidth - 80, maxY = gameArea.clientHeight - 80;
  let x = Math.random() * maxX, y = Math.random() * maxY;
  vortex.style.left = `${x}px`;
  vortex.style.top = `${y}px`;
  
  // Movimento lento do vortex
  vortex.vx = (Math.random() - 0.5) * 2;
  vortex.vy = (Math.random() - 0.5) * 2;
  
  const vortexMove = setInterval(() => {
    if (!vortex.parentNode || !gameActive || gamePaused || freezeActive) {
      clearInterval(vortexMove);
      return;
    }
    
    x += vortex.vx;
    y += vortex.vy;
    
    if (x <= 0 || x >= gameArea.clientWidth - 80) vortex.vx *= -1;
    if (y <= 0 || y >= gameArea.clientHeight - 80) vortex.vy *= -1;
    
    vortex.style.left = `${x}px`;
    vortex.style.top = `${y}px`;
    
    // Sugar bolinhas pr√≥ximas
    document.querySelectorAll('.circle').forEach(circle => {
      const circleX = parseFloat(circle.style.left) + circleSize/2;
      const circleY = parseFloat(circle.style.top) + circleSize/2;
      const distance = Math.sqrt((x + 40 - circleX)**2 + (y + 40 - circleY)**2);
      
      if (distance < 100) {
        const angle = Math.atan2(y + 40 - circleY, x + 40 - circleX);
        const force = (100 - distance) / 20;
        circle.style.left = `${parseFloat(circle.style.left) - Math.cos(angle) * force}px`;
        circle.style.top = `${parseFloat(circle.style.top) - Math.sin(angle) * force}px`;
        
        if (distance < 30) {
          score++;
          coins++;
          circle.remove();
          circles.splice(circles.indexOf(circle), 1);
          updateScore();
          updateLevelIndicator();
          updateCoinsIndicator();
        }
      }
    });
  }, 100);
  
  vortex.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    score += 5;
    coins += 5;
    vortex.remove();
    clearInterval(vortexMove);
    updateScore();
    updateLevelIndicator();
    updateCoinsIndicator();
    showBonusMessage("üå™Ô∏è VORTEX DESTRU√çDO! +5");
  });
  
  gameArea.appendChild(vortex);
  
  setTimeout(() => {
    if (vortex.parentNode) {
      vortex.remove();
      clearInterval(vortexMove);
    }
  }, 8000);
}

// üé≠ M√≠mico (Inimigo)
function spawnMimic() {
  if (document.querySelector('.mimic')) return;
  
  const mimic = document.createElement('div');
  mimic.classList.add('mimic');
  mimic.style.width = mimic.style.height = circleSize + 'px';
  
  const maxX = gameArea.clientWidth - circleSize, maxY = gameArea.clientHeight - circleSize;
  mimic.style.left = `${Math.random() * maxX}px`;
  mimic.style.top = `${Math.random() * maxY}px`;
  
  if (movementEnabled) {
    mimic.vx = (Math.random() - 0.5) * 4 * speedMultiplier;
    mimic.vy = (Math.random() - 0.5) * 4 * speedMultiplier;
  }
  
  mimic.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    timeLeft = Math.max(1, timeLeft - 15);
    mimic.remove();
    mimicsKilled++;
    showPenaltyMessage("üé≠ M√çMICO! -15s");
    updateScore();
  });
  
  gameArea.appendChild(mimic);
  
  setTimeout(() => {
    if (mimic.parentNode) mimic.remove();
  }, 6000);
}

// üëæ Mega C4 (Boss)
function spawnMegaC4() {
  if (document.querySelector('.mega-c4')) return;
  
  const megaC4 = document.createElement('div');
  megaC4.classList.add('mega-c4');
  megaC4.textContent = "MEGA C4";
  
  const maxX = gameArea.clientWidth - 120, maxY = gameArea.clientHeight - 70;
  megaC4.style.left = `${Math.random() * maxX}px`;
  megaC4.style.top = `${Math.random() * maxY}px`;
  
  megaC4.vx = (Math.random() - 0.5) * 8;
  megaC4.vy = (Math.random() - 0.5) * 8;
  
  const megaMove = setInterval(() => {
    if (!megaC4.parentNode || !gameActive || gamePaused || freezeActive) {
      clearInterval(megaMove);
      return;
    }
    
    let x = parseFloat(megaC4.style.left), y = parseFloat(megaC4.style.top);
    x += megaC4.vx;
    y += megaC4.vy;
    
    if (x <= 0 || x >= gameArea.clientWidth - 120) megaC4.vx *= -1;
    if (y <= 0 || y >= gameArea.clientHeight - 70) megaC4.vy *= -1;
    
    megaC4.style.left = `${x}px`;
    megaC4.style.top = `${y}px`;
  }, 50);
  
  megaC4.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    timeLeft += 30;
    totalBonusTime += 30;
    coins += 20;
    megaC4.remove();
    clearInterval(megaMove);
    showEpicMessage("üëæ MEGA C4 DESATIVADA! +30s");
    updateScore();
    updateTimeIndicator();
    updateCoinsIndicator();
  });
  
  gameArea.appendChild(megaC4);
  
  setTimeout(() => {
    if (megaC4.parentNode) {
      timeLeft = Math.max(1, timeLeft - 30);
      createExplosionEffect();
      megaC4.remove();
      clearInterval(megaMove);
      showPenaltyMessage("üí• MEGA C4 EXPLODIU! -30s");
      updateScore();
    }
  }, 1500);
}

// [CONTINUA√á√ÉO DOS ELEMENTOS ORIGINAIS...]
// GRANADA - Vem da parte de baixo da tela
function spawnGrenade() {
  if (document.querySelector('.grenade')) return;
  
  const grenade = document.createElement('div');
  grenade.classList.add('grenade');
  
  const x = Math.random() * (gameArea.clientWidth - 45);
  grenade.style.left = `${x}px`;
  grenade.style.top = `${gameArea.clientHeight - 10}px`;

  let currentY = gameArea.clientHeight - 10;
  const grenadeMove = setInterval(() => {
    if (!grenade.parentNode || !gameActive || gamePaused || freezeActive) {
      clearInterval(grenadeMove);
      return;
    }
    
    currentY -= 8;
    if (currentY <= 50) {
      clearInterval(grenadeMove);
    }
    grenade.style.top = `${currentY}px`;
  }, 50);
  
  grenade.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    score += 3;
    coins += 3;
    grenadesUsed++;
    explodeAllBalls();
    grenade.remove();
    clearInterval(grenadeMove);
    updateScore(); 
    updateLevelIndicator();
    updateCoinsIndicator();
    if (grenadesUsed >= 5) unlockAchievement('bomb_squad');
  });
  
  gameArea.appendChild(grenade);
  
  setTimeout(() => {
    if (grenade.parentNode) {
      grenade.remove();
      clearInterval(grenadeMove);
    }
  }, 5000);
}

// C4 - Formato realista e muito r√°pida com TEXTO PRETO
function spawnC4() {
  if (document.querySelector('.c4-bomb') || document.querySelector('.mega-c4')) return;
  
  const c4 = document.createElement('div');
  c4.classList.add('c4-bomb');
  c4.textContent = "C4";
  
  const maxX = gameArea.clientWidth - 70, maxY = gameArea.clientHeight - 40;
  c4.style.left = `${Math.random() * maxX}px`;
  c4.style.top = `${Math.random() * maxY}px`;
  
  c4.vx = (Math.random() - 0.5) * 15;
  c4.vy = (Math.random() - 0.5) * 15;
  
  c4.addEventListener('click', () => {
    if (!gameActive || gamePaused) return;
    timeLeft += 10;
    totalBonusTime += 10;
    coins += 5;
    c4Disarmed++;
    showBonusMessage("‚è∞ C4 DESATIVADA! +10s");
    c4.remove();
    clearInterval(c4MoveInterval);
    updateScore(); 
    updateTimeIndicator();
    updateCoinsIndicator();
    if (c4Disarmed >= 5) unlockAchievement('bomb_squad');
  });
  
  gameArea.appendChild(c4);
  
  const c4MoveInterval = setInterval(() => {
    if (!gameActive || gamePaused || freezeActive || !c4.parentNode) {
      clearInterval(c4MoveInterval);
      return;
    }
    
    let x = parseFloat(c4.style.left), y = parseFloat(c4.style.top);
    x += c4.vx;
    y += c4.vy;
    
    if (x <= 0 || x >= gameArea.clientWidth - 70) c4.vx *= -1;
    if (y <= 0 || y >= gameArea.clientHeight - 40) c4.vy *= -1;
    
    c4.style.left = `${x}px`; 
    c4.style.top = `${y}px`;
  }, 30);
  
  setTimeout(() => {
    if (c4.parentNode) {
      timeLeft = Math.max(1, timeLeft - 10);
      showPenaltyMessage("üí• C4 EXPLODIU! -10s");
      createExplosionEffect();
      c4.remove();
      clearInterval(c4MoveInterval);
      updateScore();
    }
  }, 2500);
}

// FLASHBANG - Congela tempo mas permite clicar nas bolas
function spawnFlashbang(){
  if(document.querySelector('.flashbang')) return;
  
  const flashbang=document.createElement('div');
  flashbang.classList.add('flashbang');
  
  const maxX=gameArea.clientWidth-35, maxY=gameArea.clientHeight-80;
  flashbang.style.left=`${Math.random()*maxX}px`;
  flashbang.style.top=`${Math.random()*maxY}px`;
  
  flashbang.addEventListener('click',()=>{
    if(!gameActive||gamePaused||freezeActive)return;
    activateFreeze();
    flashbang.remove();
  });
  
  gameArea.appendChild(flashbang);
  
  setTimeout(()=>{
    if(flashbang.parentNode){
      flashbang.remove();
    }
  }, 4000);
}

function activateFreeze(){
  freezeActive = true;
  
  const freezeEffect = document.createElement('div');
  freezeEffect.classList.add('freeze-effect');
  gameArea.appendChild(freezeEffect);
  
  const whiteFlash = document.createElement('div');
  whiteFlash.classList.add('white-flash');
  gameArea.appendChild(whiteFlash);
  
  let freezeTime = 5;
  const freezeTimer = document.createElement('div');
  freezeTimer.classList.add('freeze-timer');
  freezeTimer.textContent = freezeTime;
  gameArea.appendChild(freezeTimer);
  
  const freezeCountdown = setInterval(()=>{
    freezeTime--;
    freezeTimer.textContent = freezeTime;
    
    if(freezeTime <= 0){
      clearInterval(freezeCountdown);
      freezeActive = false;
      freezeEffect.remove();
      freezeTimer.remove();
      showBonusMessage("‚è∞ TEMPO VOLTOU!");
    }
  }, 1000);
  
  setTimeout(()=>{
    whiteFlash.remove();
  }, 500);
}

// MOLOTOV - Formato de garrafa em chamas
function spawnMolotov() {
  if (document.querySelector('.molotov') || fireActive) return;
  
  const molotov = document.createElement('div');
  molotov.classList.add('molotov');
  
  const maxX = gameArea.clientWidth - 30, maxY = gameArea.clientHeight - 50;
  molotov.style.left = `${Math.random() * maxX}px`;
  molotov.style.top = `${Math.random() * maxY}px`;
  
  molotov.addEventListener('click', () => {
    if (!gameActive || gamePaused || fireActive) return;
    activateFire();
    molotov.remove();
  });
  
  gameArea.appendChild(molotov);
  
  setTimeout(() => {
    if (molotov.parentNode) {
      molotov.remove();
    }
  }, 4000);
}

function activateFire() {
  fireActive = true;
  let molotovCount = 0;
  
  const fireEffect = document.createElement('div');
  fireEffect.classList.add('fire-effect');
  gameArea.appendChild(fireEffect);
  
  const fireWarning = document.createElement('div');
  fireWarning.classList.add('fire-warning');
  fireWarning.innerHTML = "üî• FOGO!<br>-5s por clique!";
  gameArea.appendChild(fireWarning);
  
  let fireTime = 8;
  const fireTimer = setInterval(() => {
    fireTime--;
    
    if (fireTime <= 0) {
      clearInterval(fireTimer);
      fireActive = false;
      fireEffect.remove();
      fireWarning.remove();
      showBonusMessage("üî• FOGO APAGADO!");
      molotovCount++;
      if (molotovCount >= 3) unlockAchievement('fire_proof');
    }
  }, 1000);
}

// ===== SISTEMAS AUXILIARES =====
function explodeAllBalls() {
  document.querySelectorAll('.circle').forEach(c => c.remove());
  circles = [];
  const flash = document.createElement('div');
  flash.classList.add('flash-effect');
  gameArea.appendChild(flash);
  setTimeout(() => flash.remove(), 300);
}

function createExplosionEffect() {
  const explosion = document.createElement('div');
  explosion.classList.add('explosion-effect');
  gameArea.appendChild(explosion);
  setTimeout(() => explosion.remove(), 500);
}

function enableMovement() { 
  movementEnabled = true; 
  showWarning("üö® As bolinhas come√ßaram a se mover!"); 
  circles.forEach(c => {
    c.vx = (Math.random() - 0.5) * 4 * speedMultiplier; 
    c.vy = (Math.random() - 0.5) * 4 * speedMultiplier;
  }); 
}

function increaseSpeed() { 
  showWarning("üî• Mais velocidade!"); 
  circles.forEach(c => {
    if (c.vx) {
      c.vx *= 1.8; 
      c.vy *= 1.8;
    }
  }); 
}

function activateFrenzy() { 
  frenzyMode = true; 
  showWarning("üíÄ MODO FREN√âTICO!"); 
  circles.forEach(c => {
    if (c.vx) {
      c.vx *= 1.5; 
      c.vy *= 1.5;
    }
  }); 
}

function moveCircles() { 
  circles.forEach(c => { 
    if (!c.vx) return; 
    let x = parseFloat(c.style.left), y = parseFloat(c.style.top); 
    x += c.vx; 
    y += c.vy; 
    if (x <= 0 || x >= gameArea.clientWidth - circleSize) c.vx *= -1; 
    if (y <= 0 || y >= gameArea.clientHeight - circleSize) c.vy *= -1; 
    c.style.left = `${x}px`; 
    c.style.top = `${y}px`; 
  }); 
}

function togglePause() { 
  if (freezeActive || fireActive) return;
  gamePaused = !gamePaused; 
  pauseBtn.textContent = gamePaused ? '‚ñ∂Ô∏è Continuar' : '‚è∏Ô∏è Pausar'; 
}

// ===== SISTEMA DE UI =====
function showWarning(msg) { 
  const w = document.createElement('div'); 
  w.classList.add('warning-message'); 
  w.textContent = msg; 
  gameArea.appendChild(w); 
  setTimeout(() => w.remove(), 2000); 
}

function showBonusMessage(msg) { 
  const b = document.createElement('div'); 
  b.classList.add('bonus-message'); 
  b.textContent = msg; 
  gameArea.appendChild(b); 
  setTimeout(() => b.remove(), 1500); 
}

function showPenaltyMessage(msg) { 
  const p = document.createElement('div'); 
  p.classList.add('penalty-message'); 
  p.textContent = msg; 
  gameArea.appendChild(p); 
  setTimeout(() => p.remove(), 1500); 
}

function showEpicMessage(msg) { 
  const e = document.createElement('div'); 
  e.classList.add('epic-message'); 
  e.textContent = msg; 
  gameArea.appendChild(e); 
  setTimeout(() => e.remove(), 2000); 
}

function updateScore() { 
  const modeText = {
    'classic': 'Cl√°ssico',
    'precision': 'Precis√£o', 
    'bomberman': 'Bomberman',
    'survival': 'Sobreviv√™ncia'
  };
  scoreboard.textContent = `Pontos: ${score} | Tempo: ${timeLeft}s | Modo: ${modeText[gameMode]}`; 
}

function updateLevelIndicator() { 
  document.querySelector('.level-indicator').textContent = `Pontos: ${score}`; 
}

function updateTimeIndicator() { 
  document.querySelector('.time-indicator').textContent = `C4: +${totalBonusTime}s`; 
}

function updateMultiplierIndicator() { 
  document.querySelector('.multiplier-indicator').textContent = `Multiplicador: ${pointMultiplier}x`; 
}

function updateCoinsIndicator() { 
  document.querySelector('.coins-indicator').textContent = `ü™ô: ${coins}`; 
}

function endGame() { 
  gameActive = false; 
  
  // Atualizar recorde
  if (score > highScore) {
    highScore = score;
    showEpicMessage("üèÜ NOVO RECORDE!");
  }
  
  // Conquista de sobreviv√™ncia
  if (selectedTime === 0 && score >= 100) {
    unlockAchievement('survivor');
  }
  
  clearAllIntervals();
  
  gameArea.innerHTML = `
    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.5rem;color:#ff3b3b;text-align:center;background:rgba(0,0,0,0.8);padding:20px;border-radius:15px;border:2px solid #ff3b3b;">
      üèÅ Fim de Jogo!<br>
      Pontua√ß√£o: ${score}<br>
      Tempo Extra: +${totalBonusTime}s<br>
      Moedas: ${coins} ü™ô
    </div>
  `; 
  
  totalCoins += coins;
  saveGameData();
}

function clearAllIntervals() {
  clearInterval(gameInterval);
  clearInterval(timerInterval);
  clearInterval(movementInterval);
  clearInterval(grenadeInterval);
  clearInterval(c4Interval);
  clearInterval(flashbangInterval);
  clearInterval(molotovInterval);
  clearInterval(timeOrbInterval);
  clearInterval(crystalInterval);
  clearInterval(vortexInterval);
  clearInterval(mimicInterval);
  clearInterval(bossInterval);
}

function resetGame() { 
  clearAllIntervals();
  
  score = 0;
  totalBonusTime = 0;
  coins = 0;
  pointMultiplier = 1;
  circles = [];
  movementEnabled = false;
  frenzyMode = false; 
  freezeActive = false;
  fireActive = false;
  slowmoActive = false;
  rainbowActive = false;
  
  originalCircleClickHandlers.clear();
  
  // Remover event listeners de magnet
  gameArea.removeEventListener('mousemove', handleMagnetAura);
  gameArea.removeEventListener('touchmove', handleMagnetAura);
  
  gameArea.innerHTML = `
    <div class="level-indicator">Pontos: 0</div>
    <div class="time-indicator">C4: +0s</div>
    <div class="multiplier-indicator">Multiplicador: 1x</div>
    <div class="coins-indicator">ü™ô: 0</div>
  `; 
}

function randomRange(min, max) { 
  return Math.floor(Math.random() * (max - min + 1)) + min; 
}

// Inicializar estat√≠sticas do menu
updateMenuStats();
</script>
</body>
</html>
